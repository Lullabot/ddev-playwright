#!/bin/bash
#ddev-generated
# Initialize a Playwright project interactively inside the test dir.
# Usage: ddev playwright-init [--pm npm|yarn]

set -euo pipefail

PLAYWRIGHT_TEST_DIR="${PLAYWRIGHT_TEST_DIR:-test/playwright}"
PM="npm"

while [ "$#" -gt 0 ]; do
  case "$1" in
    --pm)
      shift
      PM="$1"
      shift
      ;;
    --pm=*)
      PM="${1#*=}"
      shift
      ;;
    *)
      echo "Unknown argument: $1"
      exit 1
      ;;
  esac
done

mkdir -p "$PLAYWRIGHT_TEST_DIR"

echo "Initializing Playwright in $PLAYWRIGHT_TEST_DIR (interactive)."
if [ "$PM" = "npm" ]; then
  echo "Running: npm init playwright@latest"
  ddev exec -d /var/www/html/"$PLAYWRIGHT_TEST_DIR" npm init playwright@latest
else
  echo "Running: yarn create playwright"
  ddev exec -d /var/www/html/"$PLAYWRIGHT_TEST_DIR" yarn create playwright
fi

echo "Playwright initialization done. Add ignoreHTTPSErrors: true to your playwright.config.ts if needed."